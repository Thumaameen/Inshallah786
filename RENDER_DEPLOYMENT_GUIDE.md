# Render Production Deployment Guide
## Ultra Queen AI Raeesa Platform

This guide provides step-by-step instructions for deploying your Ultra Queen AI Raeesa platform to Render.

---

## üöÄ Quick Start Deployment

### Prerequisites
- GitHub account with this repository pushed
- Render account (sign up at https://render.com)
- Required API keys (see below)

### Step 1: Connect GitHub to Render

1. Log in to your Render Dashboard at https://dashboard.render.com
2. Click **"New +"** in the top right
3. Select **"Blueprint"**
4. Connect your GitHub account if not already connected
5. Select the repository containing this code
6. Render will automatically detect the `render.yaml` file

### Step 2: Configure the Database

The `render.yaml` file will create a PostgreSQL database named `dha-production-db`. This happens automatically, but you need to ensure:

1. The database plan is set to **Pro** (for production use)
2. Backups are enabled (configured in render.yaml)
3. The database is in the same region as your web service (Frankfurt)

### Step 3: Configure Environment Variables

Render will create most environment variables automatically via the `render.yaml` configuration. However, you **must** manually add these API keys in the Render dashboard:

#### Required AI Provider API Keys (Add at least ONE)

Navigate to your web service ‚Üí Environment tab ‚Üí Add the following:

```
OPENAI_API_KEY=sk-proj-xxxxx
ANTHROPIC_API_KEY=sk-ant-xxxxx
GEMINI_API_KEY=AIzaxxxxx
MISTRAL_API_KEY=xxxxx
PERPLEXITY_API_KEY=pplx-xxxxx
```

**To get these API keys:**
- OpenAI: https://platform.openai.com/api-keys
- Anthropic: https://console.anthropic.com/
- Google Gemini: https://aistudio.google.com/app/apikey
- Mistral: https://console.mistral.ai/
- Perplexity: https://www.perplexity.ai/settings/api

#### Optional: Blockchain RPC URLs

For Web3 functionality, add:

```
ETHEREUM_RPC_URL=https://mainnet.infura.io/v3/YOUR_PROJECT_ID
POLYGON_RPC_URL=https://polygon-mainnet.infura.io/v3/YOUR_PROJECT_ID
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
```

Get Infura project ID at: https://infura.io/

#### Optional: Government API Keys

For DHA and South African government integrations:

```
DHA_NPR_API_KEY=your-dha-npr-key
DHA_ABIS_API_KEY=your-dha-abis-key
SAPS_CRC_API_KEY=your-saps-crc-key
```

**Note:** Without these, the system will run in mock mode for government features.

### Step 4: Deploy

1. Click **"Apply"** to create all services from the blueprint
2. Render will automatically:
   - Create the PostgreSQL database
   - Create the web service
   - Create the monitoring worker
   - Create the scheduled tasks cron job
   - Run the build script: `bash render-build-production.sh`
   - Start the application with: `node dist/server/index-minimal.js`

3. Monitor the build logs in the **"Logs"** tab
4. The build should complete in 5-10 minutes

### Step 5: Verify Deployment

Once deployed, your application will be available at:
```
https://ultra-queen-ai-raeesa.onrender.com
```

**Health Check:** Visit the health endpoint to verify the service is running:
```
https://ultra-queen-ai-raeesa.onrender.com/api/health
```

You should see a JSON response with status: "healthy"

---

## üîß Build Process Details

### What Happens During Build

The `render-build-production.sh` script performs these steps:

1. ‚úÖ Verifies Node.js version (20.19.1)
2. ‚úÖ Installs root dependencies
3. ‚úÖ Builds the React frontend (client/)
4. ‚úÖ Builds the TypeScript backend (server/)
5. ‚úÖ Copies client build to dist/public/
6. ‚úÖ Creates optimized production bundles

### Build Configuration

- **Build Command:** `bash render-build-production.sh`
- **Start Command:** `node dist/server/index-minimal.js`
- **Node Version:** 20.19.1
- **Region:** Frankfurt (EU)
- **Health Check:** `/api/health`

---

## üîê Security Configuration

### Auto-Generated Secrets

These are automatically generated by Render (no action needed):

- `SESSION_SECRET`
- `JWT_SECRET`
- `ENCRYPTION_KEY`
- `QUANTUM_ENCRYPTION_KEY`
- `MASTER_ENCRYPTION_KEY`
- `BIOMETRIC_ENCRYPTION_KEY`
- `DOCUMENT_SIGNING_KEY`
- `VITE_ENCRYPTION_KEY`

### Security Best Practices

1. **API Key Rotation:** Rotate API keys every 90 days
2. **Database Backups:** Enabled every 4 hours (7-day retention)
3. **HTTPS Only:** Render provides free SSL certificates
4. **Environment Isolation:** Production keys should never be used in development

---

## üìä Monitoring & Scaling

### Auto-Scaling Configuration

The web service is configured to auto-scale:

- **Minimum Instances:** 3
- **Maximum Instances:** 10
- **Target CPU:** 65%
- **Target Memory:** 70%

### Health Monitoring

- **Health Check Path:** `/api/health`
- **Check Interval:** 15 seconds
- **Timeout:** 180 seconds

### Background Workers

The deployment includes:

1. **Monitoring Worker** - Runs continuously
   - Monitors system health
   - Tracks API performance
   - Sends alerts for issues

2. **Scheduled Tasks** - Runs every 15 minutes
   - Database cleanup
   - Cache invalidation
   - Routine maintenance

---

## üêõ Troubleshooting

### Build Failures

**Error: "Cannot find package 'vite'"**
- **Solution:** This is fixed in the updated build script. Redeploy.

**Error: "npm ci requires package-lock.json"**
- **Solution:** Package lock files have been generated. Redeploy.

**Error: "TypeScript compilation failed"**
- **Solution:** The build script uses `skipLibCheck` to handle type issues. Check logs for specific errors.

### Runtime Issues

**Error: "Port 10000 already in use"**
- **Solution:** Render automatically assigns PORT. Don't override it in environment variables.

**Error: "Database connection failed"**
- **Solution:** Verify DATABASE_URL is automatically set from the database service.

**Error: "AI Provider not responding"**
- **Solution:** Check that at least one AI provider API key is configured correctly.

### Performance Issues

**Slow Response Times:**
1. Check if auto-scaling is enabled
2. Verify database connection pooling
3. Review monitoring worker alerts
4. Consider upgrading to a higher plan

**High Memory Usage:**
1. Review NODE_OPTIONS in environment variables
2. Check for memory leaks in logs
3. Consider increasing max-old-space-size

---

## üìà Deployment Checklist

Before deploying to production:

- [ ] GitHub repository is up to date
- [ ] At least ONE AI provider API key is configured
- [ ] Database plan is set to Pro (for production)
- [ ] SSL certificate is active (automatic with Render)
- [ ] Health check endpoint is responding
- [ ] Monitoring worker is running
- [ ] Scheduled tasks are executing
- [ ] Domain name is configured (optional)
- [ ] API keys are stored securely in Render secrets
- [ ] Backup schedule is verified
- [ ] Auto-scaling is configured

---

## üåê Custom Domain Setup

To use a custom domain (e.g., `dha-thisone.com`):

1. Go to your web service in Render
2. Click **"Settings"**
3. Scroll to **"Custom Domain"**
4. Click **"Add Custom Domain"**
5. Enter your domain name
6. Follow DNS configuration instructions
7. Wait for SSL certificate provisioning (automatic)

---

## üí∞ Cost Estimate

Based on Render pricing (as of 2025):

- **Web Service (Starter):** $7/month
- **PostgreSQL (Pro):** $19/month
- **Worker (Starter):** $7/month
- **Cron Jobs:** Free

**Total:** ~$33/month for full production deployment

**Note:** Auto-scaling may increase costs during high traffic periods.

---

## üÜò Support & Resources

- **Render Documentation:** https://render.com/docs
- **Render Status Page:** https://status.render.com
- **Render Community:** https://community.render.com

### Getting Help

If you encounter issues during deployment:

1. Check the build logs in Render dashboard
2. Review the error messages in this guide
3. Verify all environment variables are set correctly
4. Check the health endpoint response
5. Review the RENDER_ENVIRONMENT_VARIABLES.md file

---

## ‚úÖ Post-Deployment Verification

After successful deployment, verify:

1. **Health Check:** `curl https://your-app.onrender.com/api/health`
2. **Frontend:** Visit the main URL and verify the UI loads
3. **AI Features:** Test at least one AI provider
4. **Database:** Check that data persists across restarts
5. **Monitoring:** Verify the monitoring worker is active

**Expected Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-11-06T15:00:00.000Z",
  "services": {
    "database": "connected",
    "ai_providers": ["openai", "anthropic"],
    "blockchain": "operational"
  }
}
```

---

## üöÄ Ready to Deploy!

Your application is now configured for production deployment on Render. Follow the steps above to get your Ultra Queen AI Raeesa platform live!

**Next Steps:**
1. Push your code to GitHub
2. Follow "Step 1: Connect GitHub to Render"
3. Configure API keys in Step 3
4. Click Deploy and monitor the build logs

Good luck with your deployment! üéâ
